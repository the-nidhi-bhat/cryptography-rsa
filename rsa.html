<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA & Hill Cipher ‚Äì World Mathematics Day 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(circle at top, #020617 0%, #020617 40%, #000 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e5e7eb;
            display: flex;
            justify-content: center;
        }

        .app-shell {
            width: 100%;
            max-width: 1100px;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: #e5e7eb;
        }

        .navbar-title {
            font-size: 1.2rem;
            font-weight: 600;
            letter-spacing: 0.03em;
        }

        .navbar-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .navbar-badge {
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            border: 1px solid #4b5563;
            color: #9ca3af;
        }

        .eli5-toggle {
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            background: rgba(34,211,238,0.15);
            border: 1px solid #22d3ee;
            color: #22d3ee;
            cursor: pointer;
            transition: all 0.2s;
        }

        .eli5-toggle:hover {
            background: rgba(34,211,238,0.25);
        }

        .container {
            background: #0b1120;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 18px 50px rgba(0,0,0,0.8);
            display: grid;
            grid-template-columns: minmax(0, 2fr) minmax(260px, 1fr);
            gap: 20px;
        }

        .main-left {
            border-right: 1px solid #111827;
            padding-right: 18px;
        }

        .main-right {
            padding-left: 12px;
        }

        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
            }
            .main-left {
                border-right: none;
                padding-right: 0;
                border-bottom: 1px solid #111827;
                padding-bottom: 16px;
                margin-bottom: 14px;
            }
            .main-right {
                padding-left: 0;
            }
        }

        h1 {
            color: #e5e7eb;
            margin-bottom: 6px;
            font-size: 1.9em;
        }

        .subtitle {
            color: #9ca3af;
            margin-bottom: 16px;
            font-size: 0.95em;
        }

        .intro-box {
            background: #020617;
            border-radius: 14px;
            padding: 14px 16px;
            margin-bottom: 16px;
            border: 1px solid rgba(34,211,238,0.4);
        }

        .intro-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #22d3ee;
            margin-bottom: 6px;
        }

        .intro-text {
            font-size: 0.88rem;
            color: #e5e7eb;
        }

        .flow-diagram {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 4px;
            background: #020617;
            border-radius: 12px;
            padding: 10px 12px;
            margin-bottom: 16px;
            font-size: 0.8rem;
        }

        .flow-item {
            padding: 4px 8px;
            border-radius: 999px;
            background: #111827;
            border: 1px solid #1f2937;
        }

        .flow-arrow {
            color: #9ca3af;
            font-size: 0.9rem;
        }

        .section {
            background: #020617;
            border-radius: 14px;
            padding: 16px 16px 18px;
            margin-bottom: 14px;
            border: 1px solid #111827;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .section h2 {
            color: #e5e7eb;
            font-size: 1.05em;
        }

        .section-subtitle {
            font-size: 0.75rem;
            color: #9ca3af;
        }

        .tag {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 999px;
            background: #111827;
            border: 1px solid #1f2937;
            color: #9ca3af;
        }

        .info-box {
            background: rgba(34,211,238,0.12);
            border-radius: 10px;
            padding: 8px 10px;
            margin-bottom: 10px;
            border-left: 3px solid #22d3ee;
            font-size: 0.8rem;
            color: #e0f2fe;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        @media (max-width: 600px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        h3 {
            font-size: 0.95rem;
            margin-bottom: 6px;
            color: #e5e7eb;
        }

        .input-group {
            margin-bottom: 10px;
            position: relative;
        }

        label {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
            font-weight: 500;
            color: #e5e7eb;
            font-size: 0.85rem;
        }

        input[type="number"], input[type="text"], textarea {
            width: 100%;
            padding: 9px 10px;
            border: 1px solid #4b5563;
            border-radius: 8px;
            font-size: 0.9rem;
            background: #020617;
            color: #e5e7eb;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
            font-family: inherit;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #22d3ee;
            box-shadow: 0 0 0 1px rgba(34,211,238,0.5);
        }

        button {
            background: linear-gradient(135deg, #22d3ee 0%, #a855f7 50%, #f97316 100%);
            color: white;
            border: none;
            padding: 9px 18px;
            border-radius: 999px;
            font-size: 0.88rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.15s, box-shadow 0.15s, opacity 0.15s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 12px 30px rgba(34,211,238,0.35);
        }

        button:active {
            transform: translateY(0);
            opacity: 0.9;
        }

        .btn-ghost {
            background: transparent;
            border: 1px solid #4b5563;
            box-shadow: none;
        }

        .btn-ghost:hover {
            box-shadow: 0 8px 20px rgba(15,23,42,0.9);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f87171 0%, #dc2626 100%);
        }

        .output {
            background: #020617;
            padding: 10px 11px;
            border-radius: 10px;
            margin-top: 10px;
            border: 1px solid #111827;
            font-size: 0.83rem;
        }

        .step {
            background: rgba(34,211,238,0.08);
            padding: 6px 8px;
            margin: 5px 0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #e5e7eb;
        }

        .key-display {
            background: rgba(250,204,21,0.08);
            padding: 9px;
            border-radius: 8px;
            margin: 6px 0;
            border-left: 3px solid #facc15;
            font-size: 0.85rem;
            transition: box-shadow 0.25s, transform 0.25s, border-color 0.25s;
        }

        .key-display strong {
            color: #fde68a;
        }

        .key-highlight {
            box-shadow: 0 0 0 1px rgba(250,204,21,0.6);
            transform: translateY(-1px);
        }

        .result {
            background: rgba(34,197,94,0.12);
            padding: 9px;
            border-radius: 8px;
            margin-top: 8px;
            border-left: 3px solid #22c55e;
            font-size: 0.9rem;
            font-weight: 600;
            color: #bbf7d0;
        }

        .error {
            background: rgba(248,113,113,0.1);
            color: #fecaca;
            padding: 8px 9px;
            border-radius: 8px;
            margin-top: 8px;
            border-left: 3px solid #f97373;
            font-size: 0.8rem;
        }

        .warning {
            background: rgba(251,191,36,0.1);
            color: #fde68a;
            padding: 8px 9px;
            border-radius: 8px;
            margin-top: 8px;
            border-left: 3px solid #fbbf24;
            font-size: 0.8rem;
        }

        .tooltip-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 16px;
            height: 16px;
            margin-left: 6px;
            border-radius: 999px;
            border: 1px solid #9ca3af;
            font-size: 0.65rem;
            color: #9ca3af;
            cursor: default;
            position: relative;
        }

        .tooltip-icon span {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            background: #020617;
            color: #e5e7eb;
            padding: 6px 8px;
            border-radius: 8px;
            font-size: 0.7rem;
            white-space: nowrap;
            border: 1px solid #111827;
            transition: opacity 0.15s;
            z-index: 20;
        }

        .tooltip-icon:hover span {
            visibility: visible;
            opacity: 1;
        }

        .status-bar {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
            font-size: 0.75rem;
        }

        .status-pill {
            padding: 4px 8px;
            border-radius: 999px;
            background: #111827;
            border: 1px solid #1f2937;
            display: flex;
            align-items: center;
            gap: 4px;
            color: #9ca3af;
        }

        .status-pill.active {
            border-color: #22c55e;
            color: #bbf7d0;
        }

        .lock-icon {
            font-size: 1.2rem;
            margin-left: 4px;
            transform-origin: center;
        }

        .lock-animate {
            animation: pulse 0.6s ease-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.25); opacity: 1; }
            100% { transform: scale(1); opacity: 0.9; }
        }

        .animation-box {
            background: #020617;
            border-radius: 12px;
            padding: 20px;
            margin: 10px 0;
            border: 1px solid #111827;
            display: flex;
            align-items: center;
            justify-content: space-around;
            min-height: 100px;
            position: relative;
        }

        .anim-element {
            padding: 10px 15px;
            border-radius: 8px;
            background: rgba(34,211,238,0.2);
            border: 2px solid #22d3ee;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.5s ease;
        }

        .anim-arrow {
            font-size: 1.5rem;
            color: #9ca3af;
            transition: all 0.3s ease;
        }

        .anim-lock {
            font-size: 2rem;
            transition: all 0.5s ease;
        }

        .encrypt-anim .anim-element:first-child {
            animation: slideEncrypt 1.5s ease-in-out;
        }

        @keyframes slideEncrypt {
            0% { transform: translateX(0); opacity: 1; }
            40% { transform: translateX(80px); opacity: 0.5; }
            60% { transform: translateX(80px) scale(0.5); opacity: 0; }
            100% { transform: translateX(0); opacity: 0; }
        }

        .decrypt-anim .anim-element:last-child {
            animation: slideDecrypt 1.5s ease-in-out;
        }

        @keyframes slideDecrypt {
            0% { transform: translateX(0); opacity: 0; }
            40% { transform: translateX(-80px); opacity: 0; }
            60% { transform: translateX(-80px) scale(1.5); opacity: 0.5; }
            100% { transform: translateX(0); opacity: 1; }
        }

        .practice-input {
            display: inline-block;
            width: 80px;
            padding: 4px 8px;
            margin: 0 4px;
            text-align: center;
            border: 2px solid #4b5563;
            border-radius: 6px;
            background: #020617;
            color: #e5e7eb;
        }

        .practice-check {
            color: #22c55e;
            margin-left: 6px;
            font-size: 1.1rem;
        }

        .practice-wrong {
            color: #f97373;
            margin-left: 6px;
            font-size: 1.1rem;
        }

        .stats-box {
            background: rgba(168,85,247,0.1);
            border-left: 3px solid #a855f7;
            padding: 8px 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.8rem;
        }

        .side-box {
            background: #020617;
            border-radius: 14px;
            padding: 12px 12px 14px;
            margin-bottom: 10px;
            border: 1px solid #111827;
            font-size: 0.82rem;
        }

        .side-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: #e5e7eb;
        }

        .bullet-list {
            list-style: none;
            margin-top: 4px;
        }

        .bullet-list li {
            padding-left: 14px;
            position: relative;
            margin: 4px 0;
            color: #e5e7eb;
        }

        .bullet-list li::before {
            content: '‚Ä¢';
            position: absolute;
            left: 2px;
            color: #22d3ee;
        }

        .cheat-row {
            display: flex;
            justify-content: space-between;
            gap: 6px;
            margin: 3px 0;
        }

        .cheat-label {
            color: #9ca3af;
        }

        .cheat-value {
            color: #e5e7eb;
            font-family: 'Courier New', monospace;
        }

        .footer {
            margin-top: 10px;
            text-align: center;
            font-size: 0.75rem;
            color: #6b7280;
        }

        .footer span {
            color: #e5e7eb;
        }

        .tab-container {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .tab-btn {
            padding: 6px 12px;
            border-radius: 8px;
            background: transparent;
            border: 1px solid #4b5563;
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .tab-btn.active {
            background: rgba(34,211,238,0.15);
            border-color: #22d3ee;
            color: #22d3ee;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .attack-progress {
            background: #111827;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .attack-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #f87171, #dc2626);
            width: 0%;
            transition: width 0.1s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: white;
            font-weight: 600;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 0.8rem;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #111827;
        }

        .comparison-table th {
            background: rgba(34,211,238,0.1);
            color: #22d3ee;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: rgba(34,211,238,0.05);
        }

        .progress-tracker {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
        }

        .progress-icon {
            font-size: 1.1rem;
        }

        .grid-visualizer {
            display: grid;
            gap: 2px;
            margin: 10px 0;
            justify-content: start;
        }

        .grid-dot {
            width: 8px;
            height: 8px;
            background: #22d3ee;
            border-radius: 2px;
        }

        .hint-box {
            background: rgba(251,191,36,0.1);
            border-left: 3px solid #fbbf24;
            padding: 8px 10px;
            margin: 6px 0;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #fde68a;
            display: none;
        }

        .hint-box.show {
            display: block;
        }

        .impact-box {
            background: rgba(168,85,247,0.15);
            border-left: 3px solid #a855f7;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 16px;
        }

        .impact-stat {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 6px 0;
            font-size: 0.85rem;
        }

        .impact-number {
            font-size: 1.2rem;
            font-weight: 700;
            color: #c084fc;
        }

        .did-you-know {
            background: rgba(34,211,238,0.1);
            border-left: 3px solid #22d3ee;
            padding: 10px 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            min-height: 60px;
            transition: opacity 0.5s ease;
        }

        .did-you-know-title {
            font-size: 0.75rem;
            color: #22d3ee;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .formula-card {
            background: #020617;
            padding: 8px;
            border-radius: 8px;
            margin: 4px 0;
            border: 1px solid #111827;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
        }

        .formula-card .formula-name {
            color: #9ca3af;
            font-size: 0.7rem;
        }

        .formula-card .formula-expr {
            color: #22d3ee;
            margin-top: 2px;
        }

        .comparison-manual {
            background: rgba(251,191,36,0.1);
            border-left: 3px solid #fbbf24;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .credits-section {
            background: #020617;
            border-radius: 10px;
            padding: 10px 12px;
            border: 1px solid #111827;
            font-size: 0.75rem;
            text-align: center;
        }

        .credits-names {
            color: #22d3ee;
            font-weight: 600;
            margin: 4px 0;
        }

        /* Hill Cipher */
        .hill-matrix {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            max-width: 180px;
            margin-top: 8px;
        }

        .hill-cell {
            width: 100%;
            padding: 9px 10px;
            border: 1px solid #4b5563;
            border-radius: 8px;
            font-size: 0.9rem;
            background: #020617;
            color: #e5e7eb;
            text-align: center;
        }

        .hill-cell:focus {
            outline: none;
            border-color: #22d3ee;
            box-shadow: 0 0 0 1px rgba(34,211,238,0.5);
        }

        /* Optional: used earlier for matrix display if needed */
        .hill-matrix-display {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            margin: 6px 0;
            color: #e5e7eb;
            white-space: pre-line;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
<div class="app-shell">
    <div class="navbar">
        <div class="navbar-title">RSA & Hill Cipher üîê</div>
        <div class="navbar-right">
            <button class="eli5-toggle" onclick="toggleELI5()">üë∂ ELI5 Mode: <span id="eli5-status">OFF</span></button>
            <div class="navbar-badge">World Mathematics Day 2025</div>
        </div>
    </div>

    <div class="container">
        <div class="main-left">
            <h1>See Cryptography, Not Just Read It</h1>
            <p class="subtitle">From primes and modular arithmetic to matrix encryption.</p>

            <div class="intro-box">
                <div class="intro-title">The Problem</div>
                <div class="intro-text" id="intro-text-normal">
                    How can two people talk secretly without sharing a password first?
                    RSA solves this using prime numbers and modular arithmetic.
                </div>
                <div class="intro-text" id="intro-text-eli5" style="display:none;">
                    Imagine you want to send a secret message. RSA is like a magic lock that anyone can close, but only your friend has the special key to open it!
                </div>
            </div>

            <!-- Real-world Impact -->
            <div class="impact-box">
                <div class="intro-title" style="color:#c084fc;">üåç Real-World Impact</div>
                <div class="impact-stat">
                    <span class="impact-number">$5 Trillion</span>
                    <span>protected in daily online transactions</span>
                </div>
                <div class="impact-stat">
                    <span class="impact-number">4.5 Billion</span>
                    <span>internet users rely on RSA every day</span>
                </div>
                <div class="impact-stat">
                    <span style="font-size:0.85rem; color:#e5e7eb;">üí° Without RSA: No online banking, shopping, or secure messaging would exist!</span>
                </div>
            </div>

            <div class="flow-diagram">
                <div class="flow-item">Message</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-item">Encrypt with Public Key</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-item">Ciphertext</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-item">Decrypt with Private Key</div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-item">Original Message</div>
            </div>

            <div class="stats-box" id="stats-display">
                üìä Session Stats: Keys Generated: <span id="stats-keys">0</span> | Messages Encrypted: <span id="stats-enc">0</span> | Messages Decrypted: <span id="stats-dec">0</span>
            </div>

            <div class="section">
                <div class="section-header">
                    <div>
                        <h2 id="keygen-title-normal">Key Generation (Math Behind the Lock)</h2>
                        <h2 id="keygen-title-eli5" style="display:none;">Make Your Magic Keys</h2>
                        <div class="section-subtitle" id="keygen-sub-normal">Choose primes, build n, find e and d.</div>
                        <div class="section-subtitle" id="keygen-sub-eli5" style="display:none;">Pick two special numbers!</div>
                    </div>
                    <div class="tag">Number Theory</div>
                </div>

                <div class="info-box">
                    Blue = explanation, Yellow = keys, Green = success, Red = errors.
                </div>

                <div class="grid-2">
                    <div class="input-group">
                        <label>Prime p
                            <div class="tooltip-icon">i
                                <span id="prime-p-tooltip-normal">p is a prime used to build n. In real RSA, p has hundreds of digits.</span>
                                <span id="prime-p-tooltip-eli5" style="display:none;">A special number only you know!</span>
                            </div>
                        </label>
                        <input type="number" id="prime-p" value="11" min="2">
                    </div>
                    <div class="input-group">
                        <label>Prime q
                            <div class="tooltip-icon">i
                                <span id="prime-q-tooltip-normal">q is another prime. p and q must be different.</span>
                                <span id="prime-q-tooltip-eli5" style="display:none;">Another special number, different from the first!</span>
                            </div>
                        </label>
                        <input type="number" id="prime-q" value="17" min="2">
                    </div>
                </div>

                <div class="status-bar" id="status-bar">
                    <div class="status-pill" id="status-key">Key Generation: ‚è≥ waiting</div>
                    <div class="status-pill" id="status-enc">Encryption: ‚è≥ waiting</div>
                    <div class="status-pill" id="status-dec">Decryption: ‚è≥ waiting</div>
                </div>

                <div style="margin-top: 10px; display:flex; gap:8px; flex-wrap:wrap;">
                    <button onclick="generateKeys()">üîë Generate Keys</button>
                    <button class="btn-ghost" onclick="tryExample()">‚≠ê Try Example (11, 17, 7)</button>
                    <button class="btn-ghost" onclick="randomizePrimes()">üé≤ Randomize Primes</button>
                </div>

                <div id="key-output"></div>

                <div id="grid-visualizer-container" style="margin-top: 12px; display: none;">
                    <div class="info-box">
                        üé® Visual: n as a grid of dots (p rows √ó q columns)
                    </div>
                    <div id="grid-visualizer" class="grid-visualizer"></div>
                </div>

                <div id="practice-mode" style="margin-top: 12px; display: none;">
                    <div class="info-box">
                        üßÆ Practice Mode: Calculate the values yourself!
                    </div>
                    <div style="margin: 8px 0;">
                        œÜ(n) = <input type="number" class="practice-input" id="practice-phi" placeholder="?">
                        <button class="btn-ghost" style="padding: 4px 12px; font-size: 0.8rem;" onclick="checkPractice('phi')">Check</button>
                        <span id="phi-feedback"></span>
                        <button class="btn-ghost" style="padding: 4px 8px; font-size: 0.75rem; margin-left: 4px;" onclick="showHint('phi', 1)">üí° Hint</button>
                    </div>
                    <div id="hint-phi-1" class="hint-box">Hint 1: œÜ(n) uses both prime numbers p and q</div>
                    <div id="hint-phi-2" class="hint-box">Hint 2: Formula is (p-1) √ó (q-1)</div>
                    <div id="hint-phi-3" class="hint-box">Hint 3: œÜ(n) = (<span id="hint-p">?</span>-1) √ó (<span id="hint-q">?</span>-1) = ?</div>
                    
                    <div style="margin: 8px 0;">
                        d = <input type="number" class="practice-input" id="practice-d" placeholder="?">
                        <button class="btn-ghost" style="padding: 4px 12px; font-size: 0.8rem;" onclick="checkPractice('d')">Check</button>
                        <span id="d-feedback"></span>
                        <button class="btn-ghost" style="padding: 4px 8px; font-size: 0.75rem; margin-left: 4px;" onclick="showHint('d', 1)">üí° Hint</button>
                    </div>
                    <div id="hint-d-1" class="hint-box">Hint 1: d is the modular inverse of e</div>
                    <div id="hint-d-2" class="hint-box">Hint 2: (e √ó d) mod œÜ(n) must equal 1</div>
                    <div id="hint-d-3" class="hint-box">Hint 3: Try small values and check if (<span id="hint-e">?</span> √ó d) mod <span id="hint-phi">?</span> = 1</div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div>
                        <h2>üî® Brute Force Attack Simulator</h2>
                        <div class="section-subtitle">See why key size matters for security</div>
                    </div>
                    <div class="tag">Security</div>
                </div>

                <div class="info-box">
                    Watch a computer try to crack your keys by factoring n!
                </div>

                <div class="comparison-manual">
                    <strong style="color:#fde68a;">‚è±Ô∏è Manual vs Computer Factoring</strong>
                    <div style="margin-top: 6px; font-size: 0.8rem;">
                        <div>üë§ <strong>Human (manual):</strong> ~10 mins for n=187 (11√ó17)</div>
                        <div>üíª <strong>Computer:</strong> 0.001 seconds for n=187</div>
                        <div>üñ•Ô∏è <strong>Supercomputer:</strong> 1 billion+ years for 2048-bit RSA!</div>
                    </div>
                </div>

                <button class="btn-danger" onclick="launchAttack()">üî® Launch Attack on Current Keys</button>

                <div id="attack-output" style="margin-top: 10px;"></div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div>
                        <h2>üìä Key Size Comparison</h2>
                        <div class="section-subtitle">Real-world security levels</div>
                    </div>
                </div>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Key Size (bits)</th>
                            <th>Example n</th>
                            <th>Time to Crack</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>8-bit</td>
                            <td>187 (11√ó17)</td>
                            <td>0.001 seconds</td>
                            <td>‚ùå Unsafe</td>
                        </tr>
                        <tr>
                            <td>16-bit</td>
                            <td>4,087 (61√ó67)</td>
                            <td>2 seconds</td>
                            <td>‚ùå Unsafe</td>
                        </tr>
                        <tr>
                            <td>32-bit</td>
                            <td>~4 billion</td>
                            <td>1 hour</td>
                            <td>‚ö†Ô∏è Weak</td>
                        </tr>
                        <tr>
                            <td>1024-bit</td>
                            <td>~10^308</td>
                            <td>100+ years</td>
                            <td>‚ö†Ô∏è Outdated</td>
                        </tr>
                        <tr style="background: rgba(34,197,94,0.05);">
                            <td><strong>2048-bit</strong></td>
                            <td>~10^617</td>
                            <td><strong>1 billion+ years</strong></td>
                            <td><strong>‚úÖ Secure</strong></td>
                        </tr>
                        <tr>
                            <td>4096-bit</td>
                            <td>~10^1233</td>
                            <td>Beyond universe lifetime</td>
                            <td>‚úÖ Very Secure</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <div class="section-header">
                    <div>
                        <h2>Encryption (Locking the Message)</h2>
                        <div class="section-subtitle">Use public key (e, n) to hide the message.</div>
                    </div>
                    <div class="tag">Public Key</div>
                </div>

                <div class="tab-container">
                    <button class="tab-btn active" onclick="switchTab('number')">Number Mode</button>
                    <button class="tab-btn" onclick="switchTab('text')">Text Mode</button>
                </div>

                <div id="tab-number" class="tab-content active">
                    <div class="info-box">
                        Encrypt using c = m<sup>e</sup> mod n.
                    </div>

                    <div class="input-group">
                        <label>Message (number)</label>
                        <input type="number" id="message" value="7" min="0">
                    </div>

                    <div style="display:flex; align-items:center; gap:8px;">
                        <button onclick="encryptMessage()">
                            üîê Encrypt
                            <span class="lock-icon" id="lock-icon">üîí</span>
                        </button>
                        <button class="btn-ghost" onclick="showEncryptStepsSlowly()">
                            üëÄ Show steps slowly
                        </button>
                    </div>
                </div>

                <div id="tab-text" class="tab-content">
                    <div class="info-box">
                        Type text - we'll convert each letter to a number (ASCII) and encrypt!
                    </div>

                    <div class="input-group">
                        <label>Your text message</label>
                        <textarea id="text-message" placeholder="Type your secret message...">HI</textarea>
                    </div>

                    <div style="display:flex; align-items:center; gap:8px;">
                        <button onclick="encryptText()">üîê Encrypt Text</button>
                    </div>
                </div>

                <div id="encrypt-output"></div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div>
                        <h2>Decryption (Unlocking the Message)</h2>
                        <div class="section-subtitle">Use private key (d, n) to recover m.</div>
                    </div>
                    <div class="tag">Private Key</div>
                </div>

                <div class="info-box">
                    Decrypt using m = c<sup>d</sup> mod n. Only the holder of d can unlock the message.
                </div>

                <div style="display:flex; align-items:center; gap:8px;">
                    <button onclick="decryptMessage()">üîì Decrypt</button>
                    <button class="btn-ghost" onclick="showDecryptStepsSlowly()">
                        üëÄ Show steps slowly
                    </button>
                </div>

                <div id="decrypt-output"></div>
            </div>

            <!-- Hill Cipher Section -->
            <div class="section" id="hill-section">
                <div class="section-header">
                    <div>
                        <h2>üî¢ Hill Cipher (2√ó2 Matrix)</h2>
                        <div class="section-subtitle">Matrix-based encryption using linear algebra mod 26</div>
                    </div>
                    <div class="tag">Linear Algebra</div>
                </div>

                <div class="info-box">
                    üí° Tip: Try the example key [[3,3],[2,5]] and encrypt "HELP" to see the classic output!
                </div>

                <!-- NEW: Alphabet mapping box -->
                <div class="info-box" style="margin-top:6px; font-size:0.78rem;">
                    üî° Alphabet to number mapping (mod 26):<br>
                    A=0, B=1, C=2, ‚Ä¶, Z=25
                </div>

                <div class="grid-2">
                    <div>
                        <h3>Key Matrix K</h3>
                        <div class="hill-matrix">
                            <input class="hill-cell" id="hill-a" type="number" value="3">
                            <input class="hill-cell" id="hill-b" type="number" value="3">
                            <input class="hill-cell" id="hill-c" type="number" value="2">
                            <input class="hill-cell" id="hill-d" type="number" value="5">
                        </div>

                        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
                            <button class="btn-ghost" onclick="hillUseExample()">‚≠ê Use Example Key</button>
                            <button class="btn-ghost" onclick="hillCheckKey()">‚úÖ Validate Key</button>
                        </div>

                        <div id="hill-key-status" style="margin-top:10px;"></div>
                    </div>

                    <div>
                        <h3>Message</h3>
                        <div class="input-group">
                            <label>Plaintext (letters A-Z only)</label>
                            <input type="text" id="hill-plain" value="HELP" placeholder="e.g., HELP">
                        </div>

                        <div style="display:flex; gap:8px; flex-wrap:wrap;">
                            <button onclick="hillEncrypt()">üîê Encrypt</button>
                            <button class="btn-ghost" onclick="hillDecrypt()">üîì Decrypt</button>
                        </div>

                        <div class="input-group" style="margin-top:10px;">
                            <label>Ciphertext</label>
                            <input type="text" id="hill-cipher" placeholder="Encrypted text appears here" readonly>
                        </div>
                    </div>
                </div>

                <div id="hill-output"></div>

                <!-- NEW: Worked example card -->
                <div class="side-box" style="margin-top:10px;">
                    <div class="side-title">üß† Example: "HE" with K = [[3,3],[2,5]]</div>
                    <p style="font-size:0.8rem; color:#d1d5db; margin-top:4px;">
                        Letter to vector: H = 7, E = 4 ‚Üí P = [7, 4]^T
                    </p>
                    <p style="font-size:0.8rem; color:#d1d5db; margin-top:4px;">
                        K ¬∑ P = [[3,3],[2,5]] ¬∑ [7,4]^T = [33, 34]^T
                    </p>
                    <p style="font-size:0.8rem; color:#d1d5db; margin-top:4px;">
                        Reduce mod 26: [33, 34] ‚â° [7, 8] (mod 26) ‚Üí 7‚ÜíH, 8‚ÜíI ‚Üí Cipher block = "HI"
                    </p>
                </div>
            </div>
        </div>

        <div class="main-right">
            <!-- Did You Know rotating facts -->
            <div class="did-you-know" id="did-you-know-box">
                <div class="did-you-know-title">üí° Did You Know?</div>
                <div id="fact-text">RSA was invented in 1977 at MIT by Ron Rivest, Adi Shamir, and Leonard Adleman.</div>
            </div>

            <!-- Mathematical Formula Reference Card -->
            <div class="side-box">
                <div class="side-title">üìê Mathematical Formulas</div>
                <div class="formula-card">
                    <div class="formula-name">Modulus (n)</div>
                    <div class="formula-expr">n = p √ó q</div>
                </div>
                <div class="formula-card">
                    <div class="formula-name">Euler's Totient œÜ(n)</div>
                    <div class="formula-expr">œÜ(n) = (p-1)(q-1)</div>
                </div>
                <div class="formula-card">
                    <div class="formula-name">Public Exponent (e)</div>
                    <div class="formula-expr">gcd(e, œÜ(n)) = 1</div>
                </div>
                <div class="formula-card">
                    <div class="formula-name">Private Exponent (d)</div>
                    <div class="formula-expr">(e √ó d) mod œÜ(n) = 1</div>
                </div>
                <div class="formula-card">
                    <div class="formula-name">Encryption</div>
                    <div class="formula-expr">c ‚â° m^e (mod n)</div>
                </div>
                <div class="formula-card">
                    <div class="formula-name">Decryption</div>
                    <div class="formula-expr">m ‚â° c^d (mod n)</div>
                </div>
            </div>

            <div class="side-box">
                <div class="side-title">üìà Learning Progress</div>
                <div class="progress-tracker">
                    <div class="progress-item">
                        <span class="progress-icon" id="progress-keys">‚è≥</span>
                        <span id="progress-keys-text">Generate Keys</span>
                    </div>
                    <div class="progress-item">
                        <span class="progress-icon" id="progress-encrypt">‚è≥</span>
                        <span id="progress-encrypt-text">Encrypt Message</span>
                    </div>
                    <div class="progress-item">
                        <span class="progress-icon" id="progress-decrypt">‚è≥</span>
                        <span id="progress-decrypt-text">Decrypt Message</span>
                    </div>
                    <div class="progress-item">
                        <span class="progress-icon" id="progress-attack">üîí</span>
                        <span id="progress-attack-text">Try Attack (locked)</span>
                    </div>
                </div>
            </div>

            <div class="side-box">
                <div class="side-title">RSA Cheat Sheet</div>
                <div class="cheat-row">
                    <div class="cheat-label">n</div>
                    <div class="cheat-value">p √ó q</div>
                </div>
                <div class="cheat-row">
                    <div class="cheat-label">œÜ(n)</div>
                    <div class="cheat-value">(p‚àí1)(q‚àí1)</div>
                </div>
                <div class="cheat-row">
                    <div class="cheat-label">Public Key</div>
                    <div class="cheat-value">(e, n)</div>
                </div>
                <div class="cheat-row">
                    <div class="cheat-label">Private Key</div>
                    <div class="cheat-value">(d, n)</div>
                </div>
                <div class="cheat-row">
                    <div class="cheat-label">Encrypt</div>
                    <div class="cheat-value">c = m^e mod n</div>
                </div>
                <div class="cheat-row">
                    <div class="cheat-label">Decrypt</div>
                    <div class="cheat-value">m = c^d mod n</div>
                </div>
            </div>

            <div class="side-box">
                <div class="side-title">In Real Life</div>
                <ul class="bullet-list">
                    <li>Online banking ‚Äì protect passwords and transactions.</li>
                    <li>HTTPS padlock ‚Äì secure websites and APIs.</li>
                    <li>Secure messaging ‚Äì only the receiver can read the text.</li>
                    <li>Hill Cipher ‚Äì historical military communications (WW2 era).</li>
                </ul>
            </div>

            <div class="side-box">
                <div class="side-title">Quick Actions</div>
                <button class="btn-ghost" style="width: 100%; margin-bottom: 6px;" onclick="togglePracticeMode()">
                    üßÆ Toggle Practice Mode
                </button>
                <button class="btn-ghost" style="width: 100%; margin-bottom: 6px;" onclick="exportKeys()">
                    üíæ Export Keys
                </button>
                <button class="btn-ghost" style="width: 100%;" onclick="resetStats()">
                    üîÑ Reset Stats
                </button>
            </div>

            <div class="credits-section">
                <div style="color:#9ca3af; font-size:0.7rem; margin-bottom:4px;">RSA Algorithm Invented By</div>
                <div class="credits-names">Ron Rivest</div>
                <div class="credits-names">Adi Shamir</div>
                <div class="credits-names">Leonard Adleman</div>
                <div style="color:#9ca3af; font-size:0.7rem; margin-top:4px;">MIT, 1977</div>
            </div>

            <div class="side-box">
                <div class="side-title">Factoring Challenge</div>
                <p style="font-size:0.8rem; color:#d1d5db;">
                    You know n = <span id="n-challenge">187</span>. Can you find p and q?
                </p>
                <p style="margin-top:6px; font-size:0.78rem; color:#9ca3af;">
                    Try dividing by small primes: 2, 3, 5, 7, 11, 13, 17, 19, 23...
                </p>
                <p style="margin-top:8px; font-size:0.78rem; color:#fbbf24; font-style:italic;">
                    In real RSA, n has 600+ digits. Even supercomputers can't factor it in a lifetime.
                </p>
            </div>
        </div>
    </div>

    <div class="footer">
        Made by <span>Nidhi</span>, 1st year CSBS | Topic: <span>Number Theory & Linear Algebra in Cryptography</span>
    </div>
</div>

<script>
    // RSA Variables
    let n, e, d, phi, p, q, ciphertext;
    let currentTab = 'number';
    let textCiphertexts = [];
    let stats = {
        keysGenerated: 0,
        messagesEncrypted: 0,
        messagesDecrypted: 0
    };
    let eli5Mode = false;
    let hintLevel = { phi: 0, d: 0 };
    let progressState = {
        keys: false,
        encrypt: false,
        decrypt: false,
        attack: false
    };

    const facts = [
        "RSA was invented in 1977 at MIT by Ron Rivest, Adi Shamir, and Leonard Adleman.",
        "The name 'RSA' comes from the first letters of the inventors' last names.",
        "RSA is based on Euler's Theorem from number theory (1736).",
        "The largest prime number used in real RSA keys has over 600 digits!",
        "Every HTTPS website you visit uses RSA or similar algorithms.",
        "Breaking a 2048-bit RSA key would take current computers over 1 billion years!",
        "RSA secures over $5 trillion in online transactions daily.",
        "The difficulty of factoring large numbers is what makes RSA secure.",
        "Quantum computers could potentially break RSA in the future - that's why 'post-quantum cryptography' is being developed!",
        "Prime numbers are the foundation of RSA - finding large primes is computationally easy, but factoring their product is extremely hard.",
        "Hill Cipher was invented in 1929 by Lester S. Hill, a mathematician and cryptographer.",
        "Hill Cipher uses linear algebra (matrix multiplication) for encryption - a revolutionary concept for its time!",
        "India faced 369 million malware attacks in 2025 (702 attacks/minute)! Strong RSA protects banking & healthcare systems.",
        "NIST recommends deprecating RSA after 2030 due to quantum computing threats - migration to post-quantum crypto has begun.",
        "Q-Day prediction: Experts forecast 45% chance RSA-2048 will be cracked by 2035 using quantum computers.",
        "India experiences 3,000+ cyber attacks daily on financial & government systems - RSA encryption is the first line of defense!"
    ];
    let currentFactIndex = 0;

    function rotateFact() {
        const factBox = document.getElementById('fact-text');
        factBox.style.opacity = '0';
        
        setTimeout(() => {
            currentFactIndex = (currentFactIndex + 1) % facts.length;
            factBox.textContent = facts[currentFactIndex];
            factBox.style.opacity = '1';
        }, 500);
    }

    setInterval(rotateFact, 8000);

    function loadStats() {
        const saved = localStorage.getItem('rsaStats');
        if (saved) {
            stats = JSON.parse(saved);
            updateStatsDisplay();
        }
        const savedProgress = localStorage.getItem('rsaProgress');
        if (savedProgress) {
            progressState = JSON.parse(savedProgress);
            updateProgressDisplay();
        }
    }

    function saveStats() {
        localStorage.setItem('rsaStats', JSON.stringify(stats));
        updateStatsDisplay();
    }

    function saveProgress() {
        localStorage.setItem('rsaProgress', JSON.stringify(progressState));
        updateProgressDisplay();
    }

    function updateStatsDisplay() {
        document.getElementById('stats-keys').textContent = stats.keysGenerated;
        document.getElementById('stats-enc').textContent = stats.messagesEncrypted;
        document.getElementById('stats-dec').textContent = stats.messagesDecrypted;
    }

    function updateProgressDisplay() {
        if (progressState.keys) {
            document.getElementById('progress-keys').textContent = '‚úÖ';
            document.getElementById('progress-keys-text').textContent = 'Generate Keys ‚úì';
        }
        if (progressState.encrypt) {
            document.getElementById('progress-encrypt').textContent = '‚úÖ';
            document.getElementById('progress-encrypt-text').textContent = 'Encrypt Message ‚úì';
        }
        if (progressState.decrypt) {
            document.getElementById('progress-decrypt').textContent = '‚úÖ';
            document.getElementById('progress-decrypt-text').textContent = 'Decrypt Message ‚úì';
        }
        if (progressState.decrypt) {
            document.getElementById('progress-attack').textContent = '‚è≥';
            document.getElementById('progress-attack-text').textContent = 'Try Attack';
        }
        if (progressState.attack) {
            document.getElementById('progress-attack').textContent = '‚úÖ';
            document.getElementById('progress-attack-text').textContent = 'Try Attack ‚úì';
        }
    }

    function resetStats() {
        if (confirm('Reset all statistics and progress?')) {
            stats = { keysGenerated: 0, messagesEncrypted: 0, messagesDecrypted: 0 };
            progressState = { keys: false, encrypt: false, decrypt: false, attack: false };
            localStorage.removeItem('rsaStats');
            localStorage.removeItem('rsaProgress');
            updateStatsDisplay();
            updateProgressDisplay();
            alert('‚úÖ Stats and progress reset successfully!');
        }
    }

    function toggleELI5() {
        eli5Mode = !eli5Mode;
        document.getElementById('eli5-status').textContent = eli5Mode ? 'ON' : 'OFF';
        
        document.getElementById('intro-text-normal').style.display = eli5Mode ? 'none' : 'block';
        document.getElementById('intro-text-eli5').style.display = eli5Mode ? 'block' : 'none';
        
        document.getElementById('keygen-title-normal').style.display = eli5Mode ? 'none' : 'block';
        document.getElementById('keygen-title-eli5').style.display = eli5Mode ? 'block' : 'none';
        document.getElementById('keygen-sub-normal').style.display = eli5Mode ? 'none' : 'block';
        document.getElementById('keygen-sub-eli5').style.display = eli5Mode ? 'block' : 'none';
        
        document.getElementById('prime-p-tooltip-normal').style.display = eli5Mode ? 'none' : 'block';
        document.getElementById('prime-p-tooltip-eli5').style.display = eli5Mode ? 'block' : 'none';
        document.getElementById('prime-q-tooltip-normal').style.display = eli5Mode ? 'none' : 'block';
        document.getElementById('prime-q-tooltip-eli5').style.display = eli5Mode ? 'block' : 'none';
    }

    function switchTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        
        if (tab === 'number') {
            document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
            document.getElementById('tab-number').classList.add('active');
        } else {
            document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
            document.getElementById('tab-text').classList.add('active');
        }
    }

    function togglePracticeMode() {
        const pm = document.getElementById('practice-mode');
        if (pm.style.display === 'none') {
            pm.style.display = 'block';
        } else {
            pm.style.display = 'none';
        }
    }

    function showHint(field, level) {
        hintLevel[field] = level;
        for (let i = 1; i <= 3; i++) {
            const hintEl = document.getElementById(`hint-${field}-${i}`);
            if (i <= level && hintEl) {
                hintEl.classList.add('show');
            }
        }
        if (level <= 2) {
            setTimeout(() => showHint(field, level + 1), 3000);
        }
    }

    function checkPractice(field) {
        const userValue = parseInt(document.getElementById(`practice-${field}`).value);
        const feedback = document.getElementById(`${field}-feedback`);
        
        if (!phi || !d) {
            feedback.innerHTML = '<span class="practice-wrong">‚ùå Generate keys first!</span>';
            return;
        }
        
        if (field === 'phi') {
            document.getElementById('hint-p').textContent = p;
            document.getElementById('hint-q').textContent = q;
        } else if (field === 'd') {
            document.getElementById('hint-e').textContent = e;
            document.getElementById('hint-phi').textContent = phi;
        }
        
        if (field === 'phi') {
            if (userValue === phi) {
                feedback.innerHTML = '<span class="practice-check">‚úÖ Correct!</span>';
                for (let i = 1; i <= 3; i++) {
                    document.getElementById(`hint-phi-${i}`).classList.remove('show');
                }
                hintLevel.phi = 0;
            } else {
                feedback.innerHTML = '<span class="practice-wrong">‚ùå Try again</span>';
            }
        } else if (field === 'd') {
            if (userValue === d) {
                feedback.innerHTML = '<span class="practice-check">‚úÖ Correct!</span>';
                for (let i = 1; i <= 3; i++) {
                    document.getElementById(`hint-d-${i}`).classList.remove('show');
                }
                hintLevel.d = 0;
            } else {
                feedback.innerHTML = '<span class="practice-wrong">‚ùå Try again</span>';
            }
        }
    }

    function launchAttack() {
        if (!n) {
            document.getElementById('attack-output').innerHTML = '<div class="error">‚ùå Generate keys first!</div>';
            return;
        }

        const output = document.getElementById('attack-output');
        const bits = Math.floor(Math.log2(n)) + 1;
        
        let html = '<div class="output">';
        html += `<h3>üî® Attacking n = ${n} (${bits}-bit)</h3>`;
        html += '<div class="attack-progress"><div class="attack-progress-bar" id="attack-bar">0%</div></div>';
        html += '<div id="attack-status">Trying to factor n...</div>';
        html += '</div>';
        
        output.innerHTML = html;

        const bar = document.getElementById('attack-bar');
        const status = document.getElementById('attack-status');
        
        let progress = 0;
        let found = false;
        const startTime = Date.now();
        
        const interval = setInterval(() => {
            progress += 5;
            bar.style.width = progress + '%';
            bar.textContent = progress + '%';
            
            if (progress >= 100) {
                clearInterval(interval);
                const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
                
                for (let i = 2; i <= Math.sqrt(n); i++) {
                    if (n % i === 0) {
                        found = true;
                        const factor1 = i;
                        const factor2 = n / i;
                        
                        if (n < 100) {
                            status.innerHTML = `<div class="error">‚ö†Ô∏è CRACKED in ${elapsed} seconds!<br>Found factors: ${factor1} √ó ${factor2} = ${n}<br><strong>This key is UNSAFE!</strong></div>`;
                        } else if (n < 10000) {
                            status.innerHTML = `<div class="warning">‚ö†Ô∏è Cracked in ${elapsed} seconds.<br>Found factors: ${factor1} √ó ${factor2}<br>Use larger primes for security!</div>`;
                        } else {
                            status.innerHTML = `<div class="result">‚úÖ Your current keys took ${elapsed} seconds to crack.<br>Real RSA (2048-bit) would take 1 billion+ years! üîí</div>`;
                        }
                        break;
                    }
                }
                
                if (!found) {
                    status.innerHTML = `<div class="result">‚úÖ Attack simulated in ${elapsed} seconds.<br>Estimated time for this key: ~${Math.floor(Math.sqrt(n) / 1000)} seconds<br>Real 2048-bit RSA: 1 billion+ years! üîí</div>`;
                }

                status.innerHTML += '<div class="warning" style="margin-top:10px;">‚ö†Ô∏è <strong>Quantum Threat Alert:</strong> Quantum computers may crack 2048-bit RSA by 2030-2035! Migrate to post-quantum cryptography standards (NIST PQC).</div>';

                progressState.attack = true;
                saveProgress();
            }
        }, 100);
    }

    function drawGridVisualizer() {
        if (!p || !q || p * q > 200) {
            document.getElementById('grid-visualizer-container').style.display = 'none';
            return;
        }

        document.getElementById('grid-visualizer-container').style.display = 'block';
        const grid = document.getElementById('grid-visualizer');
        grid.innerHTML = '';
        grid.style.gridTemplateColumns = `repeat(${q}, 8px)`;
        
        for (let i = 0; i < p * q; i++) {
            const dot = document.createElement('div');
            dot.className = 'grid-dot';
            grid.appendChild(dot);
        }
    }

    function randomizePrimes() {
        const primes = [3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73];
        const p1 = primes[Math.floor(Math.random() * primes.length)];
        let p2 = primes[Math.floor(Math.random() * primes.length)];
        while (p2 === p1) {
            p2 = primes[Math.floor(Math.random() * primes.length)];
        }
        
        document.getElementById('prime-p').value = p1;
        document.getElementById('prime-q').value = p2;
        
        generateKeys();
    }

    function exportKeys() {
        if (!n || !e || !d) {
            alert('‚ùå Generate keys first!');
            return;
        }
        
        const keyData = `RSA Key Pair\n\nPublic Key:\ne = ${e}\nn = ${n}\n\nPrivate Key:\nd = ${d}\nn = ${n}\n\np = ${p}, q = ${q}\nœÜ(n) = ${phi}\n\nGenerated: ${new Date().toLocaleString()}`;
        
        const blob = new Blob([keyData], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'rsa_keys.txt';
        a.click();
        URL.revokeObjectURL(url);
    }

    function isPrime(num) {
        if (num < 2) return false;
        if (num === 2) return true;
        if (num % 2 === 0) return false;
        for (let i = 3; i <= Math.sqrt(num); i += 2) {
            if (num % i === 0) return false;
        }
        return true;
    }

    function gcd(a, b) {
        while (b !== 0) {
            let t = b;
            b = a % b;
            a = t;
        }
        return a;
    }

    function modInverse(eVal, phiVal) {
        let m0 = phiVal, t, qTemp;
        let x0 = 0, x1 = 1;
        if (phiVal === 1) return 0;
        while (eVal > 1) {
            qTemp = Math.floor(eVal / phiVal);
            t = phiVal;
            phiVal = eVal % phiVal;
            eVal = t;
            t = x0;
            x0 = x1 - qTemp * x0;
            x1 = t;
        }
        if (x1 < 0) x1 += m0;
        return x1;
    }

    function modPow(base, exp, mod) {
        let result = 1;
        base = base % mod;
        let eLocal = exp;
        while (eLocal > 0) {
            if (eLocal % 2 === 1) {
                result = (result * base) % mod;
            }
            eLocal = Math.floor(eLocal / 2);
            base = (base * base) % mod;
        }
        return result;
    }

    function setStatus(id, text, active) {
        const el = document.getElementById(id);
        if (!el) return;
        el.textContent = text;
        if (active) el.classList.add('active');
        else el.classList.remove('active');
    }

    function flashKeys() {
        const keyBoxes = document.querySelectorAll('.key-display');
        keyBoxes.forEach(box => {
            box.classList.add('key-highlight');
            setTimeout(() => box.classList.remove('key-highlight'), 700);
        });
    }

    function animateLock() {
        const lock = document.getElementById('lock-icon');
        if (!lock) return;
        lock.classList.add('lock-animate');
        setTimeout(() => lock.classList.remove('lock-animate'), 600);
    }

    function generateKeys() {
        p = parseInt(document.getElementById('prime-p').value);
        q = parseInt(document.getElementById('prime-q').value);
        const output = document.getElementById('key-output');

        setStatus('status-key', 'Key Generation: ‚è≥ working', false);
        setStatus('status-enc', 'Encryption: ‚è≥ waiting', false);
        setStatus('status-dec', 'Decryption: ‚è≥ waiting', false);

        if (!isPrime(p)) {
            output.innerHTML = '<div class="error">‚ùå Error: p is not a prime number!</div>';
            return;
        }
        if (!isPrime(q)) {
            output.innerHTML = '<div class="error">‚ùå Error: q is not a prime number!</div>';
            return;
        }
        if (p === q) {
            output.innerHTML = '<div class="error">‚ùå Error: p and q must be different!</div>';
            return;
        }

        n = p * q;
        phi = (p - 1) * (q - 1);

        e = 3;
        while (e < phi) {
            if (gcd(e, phi) === 1) break;
            e += 2;
        }

        d = modInverse(e, phi);

        stats.keysGenerated++;
        progressState.keys = true;
        saveStats();
        saveProgress();

        let html = '<div class="output"><h3>üìä Calculation Steps</h3>';
        html += `<div class="step">Step 1: n = p √ó q = ${p} √ó ${q} = ${n}</div>`;
        html += `<div class="step">Step 2: œÜ(n) = (p‚àí1) √ó (q‚àí1) = ${p - 1} √ó ${q - 1} = ${phi}</div>`;
        html += `<div class="step">Step 3: Choose e where gcd(e, œÜ(n)) = 1 ‚Üí e = ${e}</div>`;
        html += `<div class="step">Step 4: Find d such that (e √ó d) mod œÜ(n) = 1 ‚Üí d = ${d}</div>`;
        html += `<div class="key-display"><strong>üîë Public Key:</strong> (e = ${e}, n = ${n})<br><small>Anyone can use this to encrypt.</small></div>`;
        html += `<div class="key-display"><strong>üîê Private Key:</strong> (d = ${d}, n = ${n})<br><small>Only you can use this to decrypt.</small></div>`;
        html += '</div>';

        output.innerHTML = html;
        document.getElementById('n-challenge').textContent = n;

        setStatus('status-key', 'Key Generation: ‚úÖ done', true);
        flashKeys();
        drawGridVisualizer();
    }

    function encryptMessage() {
        if (!n || !e) {
            document.getElementById('encrypt-output').innerHTML =
                '<div class="error">‚ùå Please generate keys first!</div>';
            return;
        }

        const m = parseInt(document.getElementById('message').value);
        const output = document.getElementById('encrypt-output');

        if (isNaN(m)) {
            output.innerHTML = '<div class="error">‚ùå Please enter a valid message number!</div>';
            return;
        }
        if (m >= n) {
            output.innerHTML = `<div class="error">‚ùå Message must be less than n (${n}). Try a smaller number.</div>`;
            return;
        }
        if (m < 0) {
            output.innerHTML = '<div class="error">‚ùå Message must be positive!</div>';
            return;
        }

        ciphertext = modPow(m, e, n);
        animateLock();
        stats.messagesEncrypted++;
        progressState.encrypt = true;
        saveStats();
        saveProgress();
        
        setStatus('status-enc', 'Encryption: ‚úÖ done', true);
        setStatus('status-dec', 'Decryption: ‚è≥ waiting', false);

        const powVal = Math.pow(m, e);

        let html = '<div class="animation-box encrypt-anim">';
        html += `<div class="anim-element">${m}</div>`;
        html += '<span class="anim-arrow">‚Üí</span>';
        html += '<span class="anim-lock">üîí</span>';
        html += '<span class="anim-arrow">‚Üí</span>';
        html += `<div class="anim-element">${ciphertext}</div>`;
        html += '</div>';
        
        html += '<div class="output"><h3>üîí Encryption Process</h3>';
        html += `<div class="step">Formula: c = m^e mod n</div>`;
        html += `<div class="step">c = ${m}^${e} mod ${n}</div>`;
        html += `<div class="step">${m}^${e} = ${powVal}</div>`;
        html += `<div class="step">Reduce modulo ${n}: ${powVal} mod ${n} = ${ciphertext}</div>`;
        html += `<div class="result">‚úÖ Ciphertext: ${ciphertext}</div>`;
        html += `<p style="margin-top: 7px; font-size: 0.78rem; color:#9ca3af;">The original number "${m}" is now locked as "${ciphertext}". Only the private key can unlock it.</p>`;
        html += '</div>';

        output.innerHTML = html;
    }

    function encryptText() {
        if (!n || !e) {
            document.getElementById('encrypt-output').innerHTML =
                '<div class="error">‚ùå Please generate keys first!</div>';
            return;
        }

        const text = document.getElementById('text-message').value;
        const output = document.getElementById('encrypt-output');

        if (!text) {
            output.innerHTML = '<div class="error">‚ùå Please enter some text!</div>';
            return;
        }

        textCiphertexts = [];
        let html = '<div class="output"><h3>üîí Text Encryption Process</h3>';
        
        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            const ascii = char.charCodeAt(0);
            
            if (ascii >= n) {
                output.innerHTML = `<div class="error">‚ùå Character '${char}' (ASCII ${ascii}) is too large for n=${n}. Use larger primes!</div>`;
                return;
            }
            
            const encrypted = modPow(ascii, e, n);
            textCiphertexts.push(encrypted);
            
            html += `<div class="step">'${char}' ‚Üí ASCII ${ascii} ‚Üí Encrypted: ${encrypted}</div>`;
        }

        stats.messagesEncrypted++;
        progressState.encrypt = true;
        saveStats();
        saveProgress();
        
        html += `<div class="result">‚úÖ Full Ciphertext: [${textCiphertexts.join(', ')}]</div>`;
        html += '</div>';

        output.innerHTML = html;
        ciphertext = textCiphertexts;
        setStatus('status-enc', 'Encryption: ‚úÖ done', true);
        setStatus('status-dec', 'Decryption: ‚è≥ waiting', false);
    }

    function decryptMessage() {
        if (!n || !d || ciphertext === undefined) {
            document.getElementById('decrypt-output').innerHTML =
                '<div class="error">‚ùå Please encrypt a message first!</div>';
            return;
        }

        const output = document.getElementById('decrypt-output');

        if (Array.isArray(ciphertext)) {
            let html = '<div class="output"><h3>üîì Text Decryption Process</h3>';
            let decryptedText = '';
            
            for (let i = 0; i < ciphertext.length; i++) {
                const decrypted = modPow(ciphertext[i], d, n);
                const char = String.fromCharCode(decrypted);
                decryptedText += char;
                html += `<div class="step">${ciphertext[i]} ‚Üí ASCII ${decrypted} ‚Üí '${char}'</div>`;
            }
            
            html += `<div class="result">‚úÖ Decrypted Text: "${decryptedText}"</div>`;
            html += '</div>';
            output.innerHTML = html;
        } else {
            const decrypted = modPow(ciphertext, d, n);

            let html = '<div class="animation-box decrypt-anim">';
            html += `<div class="anim-element">${ciphertext}</div>`;
            html += '<span class="anim-arrow">‚Üí</span>';
            html += '<span class="anim-lock">üîì</span>';
            html += '<span class="anim-arrow">‚Üí</span>';
            html += `<div class="anim-element">${decrypted}</div>`;
            html += '</div>';
            
            html += '<div class="output"><h3>üîì Decryption Process</h3>';
            html += `<div class="step">Formula: m = c^d mod n</div>`;
            html += `<div class="step">m = ${ciphertext}^${d} mod ${n}</div>`;
            html += `<div class="step">Compute ${ciphertext}^${d} mod ${n} using modular exponentiation.</div>`;
            html += `<div class="result">‚úÖ Original Message: ${decrypted}</div>`;
            html += `<p style="margin-top: 7px; font-size: 0.78rem; color:#9ca3af;">The unlocked number "${decrypted}" matches the original message. The math worked!</p>`;
            html += '</div>';

            output.innerHTML = html;
        }

        stats.messagesDecrypted++;
        progressState.decrypt = true;
        saveStats();
        saveProgress();
        setStatus('status-dec', 'Decryption: ‚úÖ verified (message matches)', true);
    }

    function tryExample() {
        document.getElementById('prime-p').value = 11;
        document.getElementById('prime-q').value = 17;
        document.getElementById('message').value = 7;
        generateKeys();
    }

    function showEncryptStepsSlowly() {
        if (currentTab === 'number') {
            encryptMessage();
        } else {
            encryptText();
        }
        const output = document.getElementById('encrypt-output');
        const steps = output.querySelectorAll('.step');
        steps.forEach((s, idx) => {
            s.style.opacity = '0';
            s.style.transition = 'opacity 0.2s';
            setTimeout(() => { s.style.opacity = '1'; }, 200 * (idx + 1));
        });
    }

    function showDecryptStepsSlowly() {
        decryptMessage();
        const output = document.getElementById('decrypt-output');
        const steps = output.querySelectorAll('.step');
        steps.forEach((s, idx) => {
            s.style.opacity = '0';
            s.style.transition = 'opacity 0.2s';
            setTimeout(() => { s.style.opacity = '1'; }, 220 * (idx + 1));
        });
    }

    // Hill Cipher utilities
    function hillMod(n, m) {
        return ((n % m) + m) % m;
    }

    function hillGcd(a, b) {
        a = Math.abs(a); 
        b = Math.abs(b);
        while (b !== 0) { 
            const t = b; 
            b = a % b; 
            a = t; 
        }
        return a;
    }

    function hillModInv(a, m) {
        a = hillMod(a, m);
        for (let x = 1; x < m; x++) {
            if (hillMod(a * x, m) === 1) return x;
        }
        return null;
    }

    function hillCleanText(s) {
        return (s || "").toUpperCase().replace(/[^A-Z]/g, "");
    }

    function hillGetKey() {
        const a = parseInt(document.getElementById('hill-a').value || "0", 10);
        const b = parseInt(document.getElementById('hill-b').value || "0", 10);
        const c = parseInt(document.getElementById('hill-c').value || "0", 10);
        const d = parseInt(document.getElementById('hill-d').value || "0", 10);
        return { a, b, c, d };
    }

    function hillKeyDet({a,b,c,d}) {
        return (a * d - b * c);
    }

    function hillKeyInverse2x2(key) {
        const MOD = 26;
        const det = hillKeyDet(key);
        const detMod = hillMod(det, MOD);
        const detInv = hillModInv(detMod, MOD);
        if (detInv === null) return null;

        const inv = {
            a: hillMod(detInv * key.d, MOD),
            b: hillMod(detInv * (-key.b), MOD),
            c: hillMod(detInv * (-key.c), MOD),
            d: hillMod(detInv * key.a, MOD)
        };
        return inv;
    }

    function hillVecEncrypt2(key, x, y) {
        const MOD = 26;
        const x2 = hillMod(key.a * x + key.b * y, MOD);
        const y2 = hillMod(key.c * x + key.d * y, MOD);
        return [x2, y2];
    }

    function hillNumsToText(nums) {
        return nums.map(n => String.fromCharCode(65 + hillMod(n, 26))).join("");
    }

    function hillTextToNums(text) {
        return [...text].map(ch => ch.charCodeAt(0) - 65);
    }

    function hillStatus(html) {
        document.getElementById('hill-key-status').innerHTML = html;
    }

    function hillOutput(html) {
        document.getElementById('hill-output').innerHTML = html;
    }

    function hillUseExample() {
        document.getElementById('hill-a').value = 3;
        document.getElementById('hill-b').value = 3;
        document.getElementById('hill-c').value = 2;
        document.getElementById('hill-d').value = 5;
        document.getElementById('hill-plain').value = "HELP";
        hillCheckKey();
    }

    function hillCheckKey() {
        const key = hillGetKey();
        const det = hillKeyDet(key);
        const detMod = hillMod(det, 26);
        const ok = (hillGcd(detMod, 26) === 1);
        const inv = hillKeyInverse2x2(key);

        if (!ok || !inv) {
            hillStatus(`<div class="error">‚ùå Invalid key: det(K) mod 26 = ${detMod}. Need gcd(det,26)=1 to decrypt.</div>`);
            return false;
        }

        hillStatus(`<div class="result">‚úÖ Valid key. det(K) mod 26 = ${detMod}. Inverse exists.</div>`);
        return true;
    }

    function hillEncrypt() {
        const MOD = 26;
        const key = hillGetKey();
        if (!hillCheckKey()) {
            hillOutput(`<div class="warning">‚ö†Ô∏è Fix the key matrix first, then encrypt.</div>`);
            return;
        }

        let plain = hillCleanText(document.getElementById('hill-plain').value);
        if (!plain) {
            hillOutput(`<div class="error">‚ùå Enter plaintext (letters A‚ÄìZ).</div>`);
            return;
        }
        if (plain.length % 2 === 1) plain += "X";

        const nums = hillTextToNums(plain);
        const steps = [];
        const outNums = [];

        for (let i = 0; i < nums.length; i += 2) {
            const x = nums[i], y = nums[i + 1];
            const [u, v] = hillVecEncrypt2(key, x, y);
            outNums.push(u, v);
            steps.push(`Block "${plain[i]}${plain[i+1]}" ‚Üí [${x}, ${y}] ‚Üí [${u}, ${v}] ‚Üí "${hillNumsToText([u,v])}"`);
        }

        const cipher = hillNumsToText(outNums);
        document.getElementById('hill-cipher').value = cipher;

        hillOutput(
            `<div class="output">
                <h3>üîí Hill Encryption Steps</h3>
                <div class="step">Cleaned & padded plaintext: ${plain}</div>
                ${steps.map(s => `<div class="step">${s}</div>`).join("")}
                <div class="result">‚úÖ Ciphertext: ${cipher}</div>
            </div>`
        );
    }

    function hillDecrypt() {
        const key = hillGetKey();
        const inv = hillKeyInverse2x2(key);

        if (!inv) {
            hillStatus(`<div class="error">‚ùå Invalid key: no inverse mod 26, decryption impossible.</div>`);
            hillOutput(`<div class="warning">‚ö†Ô∏è Choose a different matrix (det must be coprime with 26).</div>`);
            return;
        }

        let cipher = hillCleanText(document.getElementById('hill-cipher').value);
        if (!cipher) {
            hillOutput(`<div class="error">‚ùå Enter ciphertext (letters A‚ÄìZ) to decrypt.</div>`);
            return;
        }
        if (cipher.length % 2 === 1) {
            hillOutput(`<div class="error">‚ùå Ciphertext length must be even (2-letter blocks). Add/paste complete text.</div>`);
            return;
        }

        const nums = hillTextToNums(cipher);
        const steps = [];
        const outNums = [];

        for (let i = 0; i < nums.length; i += 2) {
            const x = nums[i], y = nums[i + 1];
            const [u, v] = hillVecEncrypt2(inv, x, y);
            outNums.push(u, v);
            steps.push(`Block "${cipher[i]}${cipher[i+1]}" ‚Üí [${x}, ${y}] ‚Üí [${u}, ${v}] ‚Üí "${hillNumsToText([u,v])}"`);
        }

        const plain = hillNumsToText(outNums);
        document.getElementById('hill-plain').value = plain;

        hillOutput(
            `<div class="output">
                <h3>üîì Hill Decryption Steps</h3>
                ${steps.map(s => `<div class="step">${s}</div>`).join("")}
                <div class="result">‚úÖ Plaintext: ${plain}</div>
                <div class="warning">üí° Note: If you padded with X during encryption, the last X may be padding.</div>
            </div>`
        );
    }

    window.onload = function() {
        loadStats();
        tryExample();
        setStatus('status-key', 'Key Generation: ‚úÖ done', true);
        document.getElementById('fact-text').style.transition = 'opacity 0.5s ease';
    };
</script>
</body>
</html>
